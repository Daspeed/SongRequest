<link rel="import" href="x-sr-controlpanel.htm">
<link rel="import" href="x-sr-queue.htm">
<link rel="import" href="x-sr-playlist.htm">
<polymer-element name="x-songrequest">
  <template>
    <x-sr-controlpanel
        id="controlPanel"
        on-next="{{next}}"
        on-pause="{{pause}}"
        on-rescan="{{rescan}}"
        on-volumechanged="{{volumeChanged}}"
        on-songchanged="{{songChanged}}">
    </x-sr-controlpanel>
    <div id="outerCombineDiv">
        <x-sr-queue
            id="queue"
            on-removedfromqueue="{{removedFromQueue}}">
        </x-sr-queue>
        <x-sr-playlist
            on-songadded="{{addSongToQueue}}">
        </x-sr-playlist>
    </div>
  </template>
  <script type="text/javascript" src="reqwest.js"></script>
  <script>
      Polymer('x-songrequest', {
          serverState: null,
          ready: function () {
            var me = this;
            setInterval(
                function () {
                    me.getQueue()
                },
                1000
            );

            this.serverState = {};
          },
          getQueue: function () {
              var me = this;
              reqwest({
                  url: '/dynamic/queue',
                  method: 'get',
                  type: 'json',
                  success: function (resp) {
                      me.$.controlPanel.serverState = resp;
                      me.$.queue.serverState = resp;
                  }
              });
          },
          next: function () {
              reqwest('/dynamic/next');
          },
          pause: function () {
              reqwest('/dynamic/pause');
          },
          rescan: function () {
              reqwest('/dynamic/rescan');
          },
          volumeChanged: function (_, newVolume) {
              reqwest({
                  url: '/dynamic/volume',
                  method: 'post',
                  data: String(newVolume)
              });
          },
          removedFromQueue: function (_, id) {
              reqwest({
                  url: '/dynamic/queue',
                  method: 'delete',
                  data: id
              });
          },
          addSongToQueue: function (_, id) {
              reqwest({
                  url: '/dynamic/queue',
                  method: 'post',
                  type: 'json',
                  data: id
              });
          },
          songChanged: function (_, name) {
              window.document.title = 'SongRequest | ' + name;
          }
      });
  </script>
</polymer-element>
